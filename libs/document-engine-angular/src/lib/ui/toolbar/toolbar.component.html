<div class="document-engine-document-editor__toolbar">
  <div class="document-engine-document-editor__toolbar-content">
    <div class="document-engine-document-editor__toolbar-left">
      <!-- History: Undo/Redo -->
      <div *ngIf="capabilities.hasHistory" class="document-engine-document-editor__toolbar-group" data-group="history">
        <button
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canUndo"
          (click)="editor.chain().focus().undo().run()"
          title="Undo (Ctrl+Z)"
        >
          <document-engine-icon name="undo"></document-engine-icon>
        </button>

        <button
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canRedo"
          (click)="editor.chain().focus().redo().run()"
          title="Redo"
        >
          <document-engine-icon name="redo"></document-engine-icon>
        </button>
      </div>

      <!-- Text Formatting: Font Size, Line Height, Text Case, Heading -->
      <div
        *ngIf="capabilities.hasTextProperty"
        class="document-engine-document-editor__toolbar-group"
        data-group="text-property"
      >
        <!-- Font Size -->
        <document-engine-select
          *ngIf="capabilities.hasFontSize"
          [value]="activeFontSize"
          placeholder="Font Size"
          labelMode="static"
          [disabled]="toolbarState.isReadOnly"
        >
          <document-engine-icon documentEngineSelectLabel name="format_size"></document-engine-icon>

          <button documentEngineSelectOption [value]="null">Default</button>

          <button
            *ngFor="let option of fontSizeOptions; trackBy: trackByValue"
            documentEngineSelectOption
            [value]="option.value"
            (click)="setFontSize(option.value)"
          >
            {{ option.label }}
          </button>
        </document-engine-select>

        <!-- Line Height -->
        <document-engine-select
          *ngIf="capabilities.hasLineHeight"
          [value]="activeLineHeight"
          placeholder="Line Height"
          labelMode="static"
          [disabled]="toolbarState.isReadOnly"
        >
          <document-engine-icon documentEngineSelectLabel name="format_line_spacing"></document-engine-icon>

          <button
            *ngFor="let option of lineHeightOptions; trackBy: trackByValue"
            documentEngineSelectOption
            [value]="option.value"
            (click)="setLineHeight(option.value)"
          >
            {{ option.label }}
          </button>
        </document-engine-select>

        <!-- Text Case -->
        <document-engine-select
          *ngIf="capabilities.hasTextCase"
          placeholder="Text Case"
          labelMode="static"
          [disabled]="toolbarState.isReadOnly"
        >
          <document-engine-icon documentEngineSelectLabel name="match_case"></document-engine-icon>

          <button
            *ngFor="let option of textCaseOptions; trackBy: trackByValue"
            documentEngineSelectOption
            [value]="option.value"
            (click)="editor.chain().focus().textCase(option.value).run()"
          >
            {{ option.label }}
          </button>
        </document-engine-select>

        <!-- Heading -->
        <document-engine-select
          *ngIf="capabilities.hasHeading"
          [value]="activeHeading?.toString() || null"
          placeholder="Normal text"
          [disabled]="toolbarState.isReadOnly"
        >
          <button
            *ngFor="let option of headingOptions; trackBy: trackByValue"
            documentEngineSelectOption
            [value]="option.value?.toString() || null"
            [class]="option.class"
            (click)="setHeading(option.value?.toString() || null)"
          >
            {{ option.label }}
          </button>
        </document-engine-select>
      </div>

      <!-- Format Utilities: Reset Formatting & Colors -->
      <div
        *ngIf="capabilities.hasFormatUtilities"
        class="document-engine-document-editor__toolbar-group"
        data-group="format-utilities"
      >
        <!-- Reset Formatting -->
        <button
          *ngIf="capabilities.hasResetFormat"
          documentEngineButton
          size="icon"
          (click)="editor.chain().focus().resetFormat().run()"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canResetFormat"
          title="Clear Formatting"
        >
          <document-engine-icon name="format_clear"></document-engine-icon>
        </button>

        <!-- Colors: Text/Background -->
        <button
          *ngIf="capabilities.hasColors"
          documentEngineButton
          size="icon"
          title="Text Color"
          [disabled]="toolbarState.isReadOnly"
          (click)="openColorBubble($event, 'text')"
        >
          <document-engine-icon name="format_color_text"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasColors"
          documentEngineButton
          size="icon"
          title="Background Color"
          [disabled]="toolbarState.isReadOnly"
          (click)="openColorBubble($event, 'fill')"
        >
          <document-engine-icon name="format_color_fill"></document-engine-icon>
        </button>
      </div>

      <!-- Text Styles: Bold/Italic/Underline/Strike -->
      <div
        *ngIf="capabilities.basicInline"
        class="document-engine-document-editor__toolbar-group"
        data-group="basic-inline"
      >
        <button
          *ngIf="capabilities.hasBold"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleBold"
          (click)="editor.chain().focus().toggleBold().run()"
          [class.active]="editor.isActive('bold')"
          title="Bold"
        >
          <document-engine-icon name="format_bold"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasItalic"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleItalic"
          (click)="editor.chain().focus().toggleItalic().run()"
          [class.active]="editor.isActive('italic')"
          title="Italic"
        >
          <document-engine-icon name="format_italic"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasUnderline"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleUnderline"
          (click)="editor.chain().focus().toggleUnderline().run()"
          [class.active]="editor.isActive('underline')"
          title="Underline"
        >
          <document-engine-icon name="format_underline"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasStrike"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleStrike"
          (click)="editor.chain().focus().toggleStrike().run()"
          [class.active]="editor.isActive('strike')"
          title="Strikethrough"
        >
          <document-engine-icon name="format_strikethrough"></document-engine-icon>
        </button>
      </div>

      <!-- Text Styles: Sub/Super/Code/Link -->
      <div
        *ngIf="capabilities.advancedInline"
        class="document-engine-document-editor__toolbar-group"
        data-group="advanced-inline"
      >
        <button
          *ngIf="capabilities.hasSubscript"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleSubscript"
          (click)="editor.chain().focus().toggleSubscript().run()"
          [class.active]="editor.isActive('subscript')"
          title="Subscript"
        >
          <document-engine-icon name="subscript"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasSuperscript"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleSuperscript"
          (click)="editor.chain().focus().toggleSuperscript().run()"
          [class.active]="editor.isActive('superscript')"
          title="Superscript"
        >
          <document-engine-icon name="superscript"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasCode"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleCode"
          (click)="editor.chain().focus().toggleCode().run()"
          [class.active]="editor.isActive('code')"
          title="Code"
        >
          <document-engine-icon name="code"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasLink"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleLink"
          (click)="toggleLink()"
          [class.active]="editor.isActive('link')"
          [title]="editor.isActive('link') ? 'Unlink' : 'Link'"
        >
          <document-engine-icon [name]="editor.isActive('link') ? 'link_off' : 'link'"></document-engine-icon>
        </button>
      </div>

      <!-- Alignment & Layout: Text Align, Indent, Lists -->
      <div
        *ngIf="capabilities.hasAlignmentLayout"
        class="document-engine-document-editor__toolbar-group"
        data-group="alignment-layout"
      >
        <!-- Text Alignment -->
        <document-engine-select
          *ngIf="capabilities.hasTextAlign"
          [value]="activeTextAlign"
          (valueChange)="setTextAlign($event)"
          placeholder="Text Align"
          labelMode="static"
          [disabled]="toolbarState.isReadOnly"
        >
          <document-engine-icon documentEngineSelectLabel [name]="activeTextAlignIcon"></document-engine-icon>

          <button
            *ngFor="let option of textAlignOptions; trackBy: trackByValue"
            documentEngineSelectOption
            [value]="option.value"
          >
            <document-engine-icon [name]="option.icon"></document-engine-icon>
            <span>{{ option.label }}</span>
          </button>
        </document-engine-select>

        <!-- Indent -->
        <button
          *ngIf="capabilities.hasIndent"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canDecreaseIndent"
          (click)="editor.chain().focus().decreaseIndent().run()"
          title="Decrease Indent"
        >
          <document-engine-icon name="format_indent_decrease"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasIndent"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canIncreaseIndent"
          (click)="editor.chain().focus().increaseIndent().run()"
          title="Increase Indent"
        >
          <document-engine-icon name="format_indent_increase"></document-engine-icon>
        </button>

        <!-- Lists: Bullet, Numbered (with style) -->
        <button
          *ngIf="capabilities.hasLists"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleBulletList"
          (click)="editor.chain().focus().toggleBulletList().run()"
          [class.active]="editor.isActive('bulletList')"
          title="Bullet List"
        >
          <document-engine-icon name="format_list_bulleted"></document-engine-icon>
        </button>

        <!-- Numbered List with Style -->
        <document-engine-select
          *ngIf="capabilities.hasLists"
          placeholder="Numbered List"
          labelMode="static"
          [value]="
            editor.isActive('customOrderedList')
              ? editor.getAttributes('customOrderedList')['data-list-style-type'] || 'decimal'
              : null
          "
          [disabled]="toolbarState.isReadOnly"
        >
          <document-engine-icon documentEngineSelectLabel name="format_list_numbered"></document-engine-icon>

          <button
            *ngFor="let option of listStyleOptions; trackBy: trackByValue"
            documentEngineSelectOption
            [value]="option.value"
            (click)="setListStyle(option.value)"
            [class.active]="
              editor.isActive('customOrderedList') &&
              editor.getAttributes('customOrderedList')['data-list-style-type'] === option.value
            "
          >
            <span>{{ option.example }}</span>
            <span>{{ option.label }}</span>
          </button>
        </document-engine-select>
      </div>

      <!-- Block Types: Code Block, Blockquote -->
      <div
        *ngIf="capabilities.hasBlockTypes"
        class="document-engine-document-editor__toolbar-group"
        data-group="block-types"
      >
        <!-- Blockquote -->
        <button
          *ngIf="capabilities.hasBlockquote"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canToggleBlockquote"
          (click)="editor.chain().focus().toggleBlockquote().run()"
          [class.active]="editor.isActive('blockquote')"
          title="Quote"
        >
          <document-engine-icon name="format_quote"></document-engine-icon>
        </button>
      </div>

      <!-- Insert Object: Table, Images, Special Chars, Page Break -->
      <div
        *ngIf="capabilities.hasInsertObject"
        class="document-engine-document-editor__toolbar-group"
        data-group="insert-object"
      >
        <button
          *ngIf="capabilities.hasTable"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly"
          (click)="openCreateTableBubble($event)"
          [class.active]="editor.isActive('table')"
          title="Table"
        >
          <document-engine-icon name="table_rows"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasImages"
          documentEngineButton
          size="icon"
          title="Insert Image"
          [disabled]="toolbarState.isReadOnly"
          (click)="insertImage($event)"
        >
          <document-engine-icon name="photo"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasSpecialChars"
          documentEngineButton
          size="icon"
          title="Special Character"
          [disabled]="toolbarState.isReadOnly"
          (click)="openSpecialCharsBubble($event)"
        >
          <document-engine-icon name="special_character"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasPageBreak"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canInsertPageBreak"
          (click)="editor.chain().focus().insertPageBreak().run()"
          title="Insert page break"
        >
          <document-engine-icon name="insert_page_break"></document-engine-icon>
        </button>
      </div>

      <!-- Business Features: Templates, Dynamic Fields, Editable Region -->
      <div
        *ngIf="capabilities.hasBusinessFeatures"
        class="document-engine-document-editor__toolbar-group"
        data-group="business-features"
      >
        <button
          *ngIf="capabilities.hasDynamicFields"
          documentEngineButton
          size="icon"
          title="Dynamic Field"
          [disabled]="toolbarState.isReadOnly"
          (click)="openDynamicFieldsBubble($event)"
        >
          <document-engine-icon name="dynamic_form"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasTemplates"
          documentEngineButton
          size="icon"
          title="Template"
          [disabled]="toolbarState.isReadOnly"
          (click)="openTemplateBubble($event)"
        >
          <document-engine-icon name="description"></document-engine-icon>
        </button>

        <button
          *ngIf="capabilities.hasEditableRegion"
          documentEngineButton
          size="icon"
          [disabled]="!toolbarState.canToggleEditableRegion || toolbarState.isReadOnly"
          (click)="editor.chain().focus().toggleEditableRegion().run()"
          [class.active]="editor.isActive('editableRegion')"
          title="Toggle editable region"
        >
          <document-engine-icon name="restrict_edit"></document-engine-icon>
        </button>
      </div>

      <!-- Actions: Clear Content, Markdown -->
      <div *ngIf="capabilities.hasActions" class="document-engine-document-editor__toolbar-group" data-group="actions">
        <button
          *ngIf="capabilities.hasClearContent"
          documentEngineButton
          size="icon"
          [disabled]="toolbarState.isReadOnly || !toolbarState.canClearContent"
          (click)="editor.chain().focus().clear().run()"
          title="Clear all content"
        >
          <document-engine-icon name="clear_all"></document-engine-icon>
        </button>

        <!-- <button
          *ngIf="capabilities.hasMarkdown"
          documentEngineButton
          size="icon"
          (click)="downloadAsMarkdown()"
          title="Download as Markdown"
        >
          <document-engine-icon name="markdown"></document-engine-icon>
        </button> -->
      </div>
    </div>

    <!-- Right side actions -->
    <div class="document-engine-document-editor__toolbar-right">
      <button documentEngineButton size="icon" (click)="printValue()" title="Print Value">
        <document-engine-icon name="print"></document-engine-icon>
      </button>
    </div>
  </div>

  <!-- Color Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    #colorBubbleMenu
    [editor]="editor"
    [config]="colorBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Link Bubble Menu -->
  <document-engine-editor-bubble-menu
    *ngIf="capabilities.hasLink"
    #linkBubbleWrapper
    [editor]="editor"
    [config]="linkBubbleConfig"
  ></document-engine-editor-bubble-menu>

  <!-- Table Bubble Menu -->
  <document-engine-editor-bubble-menu
    *ngIf="capabilities.hasTable"
    #tableBubbleWrapper
    [editor]="editor"
    [config]="tableBubbleConfig"
  ></document-engine-editor-bubble-menu>

  <!-- Image Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="capabilities.hasImages"
    #imageBubbleMenu
    [editor]="editor"
    [config]="imageBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Special Characters Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="capabilities.hasSpecialChars"
    #specialCharsBubbleMenu
    [editor]="editor"
    [config]="specialCharsBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Dynamic Fields Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="capabilities.hasDynamicFields"
    #dynamicFieldsBubbleMenu
    [editor]="editor"
    [config]="dynamicFieldsBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Template Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="capabilities.hasTemplates"
    #templateBubbleMenu
    [editor]="editor"
    [config]="templateBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Table Create Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="capabilities.hasTable"
    #tableCreateBubbleMenu
    [editor]="editor"
    [config]="tableCreateBubbleConfig"
  ></document-engine-toolbar-bubble-menu>
</div>
