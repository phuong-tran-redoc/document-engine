<div class="document-engine-document-editor__toolbar">
  <div class="document-engine-document-editor__toolbar-content">
    <div class="document-engine-document-editor__toolbar-left">
      <!-- History: Undo/Redo -->
      <div *ngIf="hasHistory()" class="document-engine-document-editor__toolbar-group">
        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().undo().run()"
          (click)="editor.chain().focus().undo().run()"
          title="Undo (Ctrl+Z)"
        >
          <document-engine-icon name="undo"></document-engine-icon>
        </button>
        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().redo().run()"
          (click)="editor.chain().focus().redo().run()"
          title="Redo"
        >
          <document-engine-icon name="redo"></document-engine-icon>
        </button>
      </div>

      <div *ngIf="hasHistory() && hasFormatting()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Text Formatting: Font Size, Line Height, Text Case, Heading -->
      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-group">
        <!-- Font Size -->
        <document-engine-select [value]="activeFontSize" placeholder="Font Size" labelMode="static">
          <document-engine-icon documentEngineSelectLabel name="format_size"></document-engine-icon>

          <button documentEngineSelectOption [value]="null">Default</button>

          @for (option of fontSizeOptions; track option.value) {
          <button documentEngineSelectOption [value]="option.value" (click)="setFontSize(option.value)">
            {{ option.label }}
          </button>
          }
        </document-engine-select>

        <!-- Line Height -->
        <document-engine-select [value]="activeLineHeight" placeholder="Line Height" labelMode="static">
          <document-engine-icon documentEngineSelectLabel name="format_line_spacing"></document-engine-icon>

          @for (option of lineHeightOptions; track option.value) {
          <button documentEngineSelectOption [value]="option.value" (click)="setLineHeight(option.value)">
            {{ option.label }}
          </button>
          }
        </document-engine-select>

        <!-- Text Case -->
        <document-engine-select *ngIf="hasTextCase()" placeholder="Text Case" labelMode="static">
          <document-engine-icon documentEngineSelectLabel name="match_case"></document-engine-icon>

          @for (option of textCaseOptions; track option.value) {
          <button
            documentEngineSelectOption
            [value]="option.value"
            (click)="editor.chain().focus().textCase(option.value).run()"
          >
            {{ option.label }}
          </button>
          }
        </document-engine-select>

        <!-- Heading -->
        <document-engine-select
          *ngIf="hasHeading()"
          [value]="activeHeading?.toString() || null"
          placeholder="Normal text"
        >
          @for (option of headingOptions; track option.value) {
          <button
            documentEngineSelectOption
            [value]="option.value?.toString() || null"
            [class]="option.class"
            (click)="setHeading(option.value?.toString() || null)"
          >
            {{ option.label }}
          </button>
          }
        </document-engine-select>
      </div>

      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Reset Formatting -->
      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-group">
        <button
          documentEngineButton
          size="icon"
          (click)="editor.chain().focus().resetFormat().run()"
          [disabled]="!editor.can().chain().focus().resetFormat().run()"
          title="Clear Formatting"
        >
          <document-engine-icon name="format_clear"></document-engine-icon>
        </button>
      </div>

      <div *ngIf="hasFormatting() && hasColors()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Colors: Text/Background -->
      <div *ngIf="hasColors()" class="document-engine-document-editor__toolbar-group">
        <button documentEngineButton size="icon" title="Text Color" (click)="openColorBubble($event, 'text')">
          <document-engine-icon name="format_color_text"></document-engine-icon>
        </button>

        <button documentEngineButton size="icon" title="Background Color" (click)="openColorBubble($event, 'fill')">
          <document-engine-icon name="format_color_fill"></document-engine-icon>
        </button>
      </div>

      <div *ngIf="hasColors() && hasFormatting()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Text Styles: Bold/Italic/Underline/Strike -->
      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-group">
        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleBold().run()"
          (click)="editor.chain().focus().toggleBold().run()"
          [class.active]="editor.isActive('bold')"
          title="Bold"
        >
          <document-engine-icon name="format_bold"></document-engine-icon>
        </button>

        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleItalic().run()"
          (click)="editor.chain().focus().toggleItalic().run()"
          [class.active]="editor.isActive('italic')"
          title="Italic"
        >
          <document-engine-icon name="format_italic"></document-engine-icon>
        </button>

        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleUnderline().run()"
          (click)="editor.chain().focus().toggleUnderline().run()"
          [class.active]="editor.isActive('underline')"
          title="Underline"
        >
          <document-engine-icon name="format_underline"></document-engine-icon>
        </button>

        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleStrike().run()"
          (click)="editor.chain().focus().toggleStrike().run()"
          [class.active]="editor.isActive('strike')"
          title="Strikethrough"
        >
          <document-engine-icon name="format_strikethrough"></document-engine-icon>
        </button>
      </div>

      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Text Styles: Sub/Super/Code -->
      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-group">
        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleSubscript().run()"
          (click)="editor.chain().focus().toggleSubscript().run()"
          [class.active]="editor.isActive('subscript')"
          title="Subscript"
        >
          <document-engine-icon name="subscript"></document-engine-icon>
        </button>

        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleSuperscript().run()"
          (click)="editor.chain().focus().toggleSuperscript().run()"
          [class.active]="editor.isActive('superscript')"
          title="Superscript"
        >
          <document-engine-icon name="superscript"></document-engine-icon>
        </button>

        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleCode().run()"
          (click)="editor.chain().focus().toggleCode().run()"
          [class.active]="editor.isActive('code')"
          title="Code"
        >
          <document-engine-icon name="code"></document-engine-icon>
        </button>
      </div>

      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Text Alignment -->
      <div *ngIf="hasFormatting()" class="document-engine-document-editor__toolbar-group">
        <document-engine-select
          [value]="activeTextAlign"
          (valueChange)="setTextAlign($event)"
          placeholder="Text Align"
          labelMode="static"
        >
          <document-engine-icon documentEngineSelectLabel [name]="activeTextAlignIcon"></document-engine-icon>

          @for (option of textAlignOptions; track option.value) {
          <button documentEngineSelectOption [value]="option.value">
            <document-engine-icon [name]="option.icon"></document-engine-icon>
            <span>{{ option.label }}</span>
          </button>
          }
        </document-engine-select>

        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleBlockquote().run()"
          (click)="editor.chain().focus().toggleBlockquote().run()"
          [class.active]="editor.isActive('blockquote')"
          title="Quote"
        >
          <document-engine-icon name="format_quote"></document-engine-icon>
        </button>
      </div>

      <div *ngIf="hasFormatting() && hasIndent()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Indent -->
      <div *ngIf="hasIndent()" class="document-engine-document-editor__toolbar-group">
        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().decreaseIndent().run()"
          (click)="editor.chain().focus().decreaseIndent().run()"
          title="Decrease Indent"
        >
          <document-engine-icon name="format_indent_decrease"></document-engine-icon>
        </button>

        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().increaseIndent().run()"
          (click)="editor.chain().focus().increaseIndent().run()"
          title="Increase Indent"
        >
          <document-engine-icon name="format_indent_increase"></document-engine-icon>
        </button>
      </div>

      <div *ngIf="hasIndent() && hasLists()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Lists: Bullet, Numbered (with style) -->
      <div *ngIf="hasLists()" class="document-engine-document-editor__toolbar-group">
        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleBulletList().run()"
          (click)="editor.chain().focus().toggleBulletList().run()"
          [class.active]="editor.isActive('bulletList')"
          title="Bullet List"
        >
          <document-engine-icon name="format_list_bulleted"></document-engine-icon>
        </button>

        <!-- Numbered List with Style -->
        <document-engine-select
          placeholder="Numbered List"
          labelMode="static"
          [value]="
            editor.isActive('customOrderedList')
              ? editor.getAttributes('customOrderedList')['data-list-style-type'] || 'decimal'
              : null
          "
        >
          <document-engine-icon documentEngineSelectLabel name="format_list_numbered"></document-engine-icon>

          @for (option of listStyleOptions; track option.value) {
          <button
            documentEngineSelectOption
            [value]="option.value"
            (click)="setListStyle(option.value)"
            [class.active]="
              editor.isActive('customOrderedList') &&
              editor.getAttributes('customOrderedList')['data-list-style-type'] === option.value
            "
          >
            <span>{{ option.example }}</span>
            <span>{{ option.label }}</span>
          </button>
          }
        </document-engine-select>
      </div>

      <div
        *ngIf="hasLists() && (hasTable() || hasAdvanced())"
        class="document-engine-document-editor__toolbar-divider"
      ></div>

      <!-- Advanced: Table, Links, Images, Special Chars, Dynamic Fields -->
      <div *ngIf="hasTable() || hasAdvanced()" class="document-engine-document-editor__toolbar-group">
        <button
          *ngIf="hasTable()"
          documentEngineButton
          size="icon"
          (click)="openCreateTableBubble($event)"
          [class.active]="editor.isActive('table')"
          title="Table"
        >
          <document-engine-icon name="table_rows"></document-engine-icon>
        </button>
        <button
          *ngIf="hasLinks()"
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleLink().run()"
          (click)="toggleLink()"
          [class.active]="editor.isActive('link')"
          [title]="editor.isActive('link') ? 'Unlink' : 'Link'"
        >
          <document-engine-icon [name]="editor.isActive('link') ? 'link_off' : 'link'"></document-engine-icon>
        </button>

        <button *ngIf="hasImages()" documentEngineButton size="icon" title="Insert Image" (click)="insertImage($event)">
          <document-engine-icon name="photo"></document-engine-icon>
        </button>

        <button
          *ngIf="hasSpecialChars()"
          documentEngineButton
          size="icon"
          title="Special Character"
          (click)="openSpecialCharsBubble($event)"
        >
          <document-engine-icon name="special_character"></document-engine-icon>
        </button>

        <button
          *ngIf="hasDynamicFields()"
          documentEngineButton
          size="icon"
          title="Dynamic Field"
          (click)="openDynamicFieldsBubble($event)"
        >
          <document-engine-icon name="dynamic_form"></document-engine-icon>
        </button>

        <button
          *ngIf="hasTemplates()"
          documentEngineButton
          size="icon"
          title="Template"
          (click)="openTemplateBubble($event)"
        >
          <document-engine-icon name="description"></document-engine-icon>
        </button>
      </div>

      <div
        *ngIf="(hasTable() || hasAdvanced()) && (hasEditableRegion() || hasClearContent() || hasPageBreak())"
        class="document-engine-document-editor__toolbar-divider"
      ></div>

      <!-- Utilities: Editable Region, Clear Content, Markdown -->
      <div class="document-engine-document-editor__toolbar-group">
        <button
          *ngIf="hasEditableRegion()"
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().toggleEditableRegion().run()"
          (click)="editor.chain().focus().toggleEditableRegion().run()"
          [class.active]="editor.isActive('editableRegion')"
          title="Toggle editable region"
        >
          <document-engine-icon name="restrict_edit"></document-engine-icon>
        </button>

        <button
          *ngIf="hasClearContent()"
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().clear().run()"
          (click)="editor.chain().focus().clear().run()"
          title="Clear all content"
        >
          <document-engine-icon name="clear_all"></document-engine-icon>
        </button>

        <!-- <button
          *ngIf="hasMarkdown()"
          documentEngineButton
          size="icon"
          (click)="downloadAsMarkdown()"
          title="Download as Markdown"
        >
          <document-engine-icon name="markdown"></document-engine-icon>
        </button> -->
      </div>

      <div *ngIf="hasPageBreak()" class="document-engine-document-editor__toolbar-divider"></div>

      <!-- Page Break -->
      <div *ngIf="hasPageBreak()" class="document-engine-document-editor__toolbar-group">
        <button
          documentEngineButton
          size="icon"
          [disabled]="!editor.can().chain().focus().insertPageBreak().run()"
          (click)="editor.chain().focus().insertPageBreak().run()"
          title="Insert page break"
        >
          <document-engine-icon name="insert_page_break"></document-engine-icon>
        </button>
      </div>
    </div>

    <!-- Right side actions -->
    <div class="document-engine-document-editor__toolbar-right">
      <button documentEngineButton size="icon" (click)="printValue()" title="Print Value">
        <document-engine-icon name="print"></document-engine-icon>
      </button>
    </div>
  </div>

  <!-- Color Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    #colorBubbleMenu
    [editor]="editor"
    [config]="colorBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Link Bubble Menu -->
  <document-engine-editor-bubble-menu
    *ngIf="hasLinks()"
    #linkBubbleWrapper
    [editor]="editor"
    [config]="linkBubbleConfig"
  ></document-engine-editor-bubble-menu>

  <!-- Table Bubble Menu -->
  <document-engine-editor-bubble-menu
    *ngIf="hasTable()"
    #tableBubbleWrapper
    [editor]="editor"
    [config]="tableBubbleConfig"
  ></document-engine-editor-bubble-menu>

  <!-- Image Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="hasImages()"
    #imageBubbleMenu
    [editor]="editor"
    [config]="imageBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Special Characters Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="hasSpecialChars()"
    #specialCharsBubbleMenu
    [editor]="editor"
    [config]="specialCharsBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Dynamic Fields Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="hasDynamicFields()"
    #dynamicFieldsBubbleMenu
    [editor]="editor"
    [config]="dynamicFieldsBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Template Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="hasTemplates()"
    #templateBubbleMenu
    [editor]="editor"
    [config]="templateBubbleConfig"
  ></document-engine-toolbar-bubble-menu>

  <!-- Table Create Bubble Menu -->
  <document-engine-toolbar-bubble-menu
    *ngIf="hasTable()"
    #tableCreateBubbleMenu
    [editor]="editor"
    [config]="tableCreateBubbleConfig"
  ></document-engine-toolbar-bubble-menu>
</div>
